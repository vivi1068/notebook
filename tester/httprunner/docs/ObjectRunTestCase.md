### RunTestCase 对象  

- 从对象的角度来看, 它没有继承任何对象, 是一个简单的类对象.  
- 从对象的角色来看, 它是一个用例, 它负责包裹子用例.  
- 从对象的方法来看,   
  `with_variables`方法就是负责收集变量并将变量向下传递给包裹的子用例.   
  `call`方法是将子用例赋值给 Tstep.testcase , 然后返回另外一个对象去负责收集其他变量.

```python3
from typing import Text, Any, Union, Callable

from httprunner.models import (
    TConfig,
    TStep,
    TRequest,
    MethodEnum,
    TestCase,
)


# 当前对象是一个参数采集对象.
class RunTestCase(object):
    def __init__(self, name: Text):
        self.__step_context = TStep(name=name)

    # 当前步骤的函数变量`function variable`
    # 此时此刻用例还没有开始运行, 定义在RunTestCase的变量, 会传递给teststep用例.
    def with_variables(self, **variables) -> "RunTestCase":
        self.__step_context.variables.update(variables)
        return self

    # TODO: 待补充
    def setup_hook(self, hook: Text, assign_var_name: Text = None) -> "RunTestCase":
        if assign_var_name:
            self.__step_context.setup_hooks.append({assign_var_name: hook})
        else:
            self.__step_context.setup_hooks.append(hook)

        return self

    # 将子用例赋值给 Tstep.testcase , 然后返回另外一个对象去负责收集其他变量.
    def call(self, testcase: Callable) -> StepRefCase:
        self.__step_context.testcase = testcase
        return StepRefCase(self.__step_context)

    # self.__step_context 是 TStep 对象.
    def perform(self) -> TStep:
        return self.__step_context

```


**RunTestCase**对应的是`.yml`的测试步骤(引用子用例), 由`make.py`生成.  

```python3
# NOTE: Generated By HttpRunner v3.1.6
# FROM: testcases/create-user-ref.yml


import sys
from pathlib import Path

sys.path.insert(0, str(Path(__file__).parent.parent))


from httprunner import HttpRunner, Config, Step, RunRequest, RunTestCase

from apis.login_test import TestCaseLogin as Login

from apis.create_user_test import TestCaseCreateUser as CreateUser

from apis.list_users_test import TestCaseListUsers as ListUsers

from apis.logout_test import TestCaseLogout as Logout


class TestCaseCreateUserRef(HttpRunner):

    config = Config("testcases module variable")

    teststeps = [
        Step(
            RunTestCase("login")
            .with_variables(
                **{
                    "host": "http://127.0.0.1:8888",
                    "username": "zhangsan",
                    "password": "zhangsan123",
                    "status_code": 200,
                    "body_status": 200,
                    "body_msg": "login success",
                }
            )
            .call(Login)
        ),
        Step(
            RunTestCase("create user")
            .with_variables(
                **{
                    "host": "http://127.0.0.1:8888",
                    "username": "lisi",
                    "status_code": 200,
                    "body_status": 200,
                    "body_msg": "user ${username} create success.",
                }
            )
            .call(CreateUser)
        ),
        Step(
            RunTestCase("get all users")
            .with_variables(
                **{
                    "host": "http://127.0.0.1:8888",
                    "status_code": 200,
                    "body_status": 200,
                    "body_msg": ["zhangsan", "lisi"],
                }
            )
            .call(ListUsers)
        ),
        Step(
            RunTestCase("logout")
            .with_variables(
                **{
                    "host": "http://127.0.0.1:8888",
                    "status_code": 200,
                    "body_status": 200,
                    "body_msg": "logout success",
                }
            )
            .call(Logout)
        ),
        Step(
            RunTestCase("get all users")
            .with_variables(
                **{
                    "host": "http://127.0.0.1:8888",
                    "status_code": 200,
                    "body_status": 400,
                    "body_msg": "permission deny.",
                }
            )
            .call(ListUsers)
        ),
    ]


if __name__ == "__main__":
    TestCaseCreateUserRef().test_start()

```
